/* voiceLive 1.1.6 Copyright (c) 2016 "Lzwai" | Licensed under the MIT license. | see:  for details */
!function(a,b){"function"==typeof define&&define.amd?define(["howler"],b):"object"==typeof exports?module.exports=b(require("howler")):a.VoiceLive=b(Howl)}(this,function(a){"use strict";a=a.Howl||a;var b=function(){},c=function(a){for(var b={},c=0,d=a.length;c<d;c++){var e=a[c];b[e.id]=e}return b},d=function(a){return Object.prototype.toString.call(a).indexOf("Array")!==-1},e=function(a){this._init(a)};return e.prototype={_init:function(a){if(!a)throw new Error("options is wrong!");if(!d(a.datas))throw new Error("datas must be array");this.curItemId="",this.curItemIndex="",this.step=a.step||b,this.events=a.events||{},this.originLists=a.datas,this.playLists=c(a.datas)},_getCurItemIndex:function(a){for(var b=0,c=this.originLists.length;b<c;b++){var d=this.originLists[b];if(d.id.toString()===a.toString())return b}},_step:function(a){var b=this.playLists[a],c=b&&b.howl;if(c&&c.playing()){var d=c.seek(),e=c.duration();this.step(a,d,d/e,e),window.requestAnimationFrame(this._step.bind(this,a))}},addVoice:function(a){if(d(a))for(var b=0,c=a.length;b<c;b++){var e=a[b];this.originLists.push(e),this.playLists[e.id]=e}else this.originLists.push(a),this.playLists[a.id]=a;return this},replaceVoice:function(a,b){var c=this.playLists[a],d=c&&c.howl;if(d){if(d.playing())return;this.destory(a)}this.playLists[a].src=b,this.originLists[this.curItemIndex].src=b},_playInit:function(b){var c=this,d=this.playLists[b],e=this.events,f=d.howl;return f||(f=new a({src:d.src,volume:1,preload:!0,onload:function(){e.onload&&e.onload.call(c)},onloaderror:function(){e.onloaderror&&e.onloaderror.call(c)},onplay:function(){window.requestAnimationFrame(c._step.bind(c,b)),e.onplay&&e.onplay.call(c)},onpause:function(){e.onpause&&e.onpause.call(c)},onstop:function(){e.onstop&&e.onstop.call(c)},onend:function(){c.playLists[b].currentTime=0,e.onend&&e.onend.call(c)}})),f},play:function(a){var b=this.playLists[a],c=this._playInit(a);if(""!==this.curItemId&&this.pause(this.curItemId),!c.playing()){c.seek(+b.currentTime.toFixed(0)),c.play(),this.playLists[a].howl=c,this.curItemId=b.id,this.curItemIndex=this._getCurItemIndex(a);var d=this.originLists[this.curItemIndex+1];return d&&this._playInit(d.id),this}},pause:function(a){var b=this.playLists[a],c=b&&b.howl;return c&&(this.curItemId="",c.pause(),this.playLists[a].currentTime=c.seek()),this},stop:function(a){var b=this.playLists[a],c=b&&b.howl;return c&&(this.curItemId="",c.stop(),this.playLists[a].currentTime=0),this},seek:function(a,b){var c=this._playInit(a);c.seek(+b)},destory:function(a,b){if("function"==typeof a&&(b=a,a=""),a){var c=this.playLists[a],d=c&&c.howl;return d?(this.curItemId==a&&this.pause(a),d.unload(),this.playLists[a].howl=null,this.playLists[a].currentTime=0,b&&b(this.playLists[a]),this):this}this.curItemId&&this.pause(this.curItemId);var e=Object.keys(this.playLists),f=this;return e.forEach(function(a,c){var d=f.playLists[a];d&&d.howl&&(d.howl.unload(),f.playLists[a].howl=null,f.playLists[a].currentTime=0),b&&e.length-1===c&&b(f.playLists)}),this},playNext:function(a){if(""!==this.curItemIndex){var b=this.originLists[++this.curItemIndex];b&&(this.playLists[b.id].currentTime=0,this.play(b.id))}},playPre:function(a){if(""!==this.curItemIndex){var b=this.originLists[--this.curItemIndex];if(b){var c=this.playLists[b.id],d=c&&c.howl;void 0!==a&&d&&d.seek(0),this.play(b.id)}}}},e});