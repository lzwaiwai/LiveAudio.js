/* voice-live 1.1.12 Copyright (c) 2016 "Lzwai" | Licensed under the MIT license. | see:  for details */
!function(t,i){"function"==typeof define&&define.amd?define(["howler"],i):"object"==typeof exports?module.exports=i(require("howler")):t.VoiceLive=i(Howl)}(this,function(r){"use strict";r=r.Howl||r;var i=function(){},e=function(t){return-1!==Object.prototype.toString.call(t).indexOf("Array")},t=function(t){this._init(t)};return t.prototype={_init:function(t){if(!t)throw new Error("options is wrong!");if(!e(t.datas))throw new Error("datas must be array");this.curItemId="",this.curItemIndex="",this.format=t.format||["mp3"],this.step=t.step||i,this.events=t.events||{},this.originLists=t.datas,this.playLists=function(t){for(var i={},s=0,n=t.length;s<n;s++){var e=t[s];i[e.id]=e}return i}(t.datas)},_getCurItemIndex:function(t){for(var i=0,s=this.originLists.length;i<s;i++){if(this.originLists[i].id.toString()===t.toString())return i}},_step:function(t){var i=this.playLists[t],s=i&&i.howl;if(s&&s.playing()){var n=s.seek(),e=s.duration();this.step(t,n,n/e,e),window.requestAnimationFrame(this._step.bind(this,t))}},addVoice:function(t){if(e(t))for(var i=0,s=t.length;i<s;i++){var n=t[i];this.originLists.push(n),this.playLists[n.id]=n}else this.originLists.push(t),this.playLists[t.id]=t;return this},replaceVoice:function(t,i){var s=this.playLists[t],n=s&&s.howl;if(n){if(n.playing())return;this.destory(t)}this.playLists[t].src=i,this.originLists[this.curItemIndex].src=i},_playInit:function(t){var i=this,s=this.playLists[t],n=this.events,e=s.howl;return e||(e=new r({src:s.src,volume:1,preload:!0,format:this.format,onload:function(){n.onload&&n.onload.call(i)},onloaderror:function(){n.onloaderror&&n.onloaderror.call(i)},onplay:function(){window.requestAnimationFrame(i._step.bind(i,t)),n.onplay&&n.onplay.call(i)},onpause:function(){n.onpause&&n.onpause.call(i)},onstop:function(){n.onstop&&n.onstop.call(i)},onend:function(){i.playLists[t].currentTime=0,n.onend&&n.onend.call(i)}})),e},play:function(t){var i=this.playLists[t],s=this._playInit(t);if(""!==this.curItemId&&this.pause(this.curItemId),!s.playing()){s.seek(0==+i.currentTime?0:+i.currentTime.toFixed(0)),s.play(),this.playLists[t].howl=s,this.curItemId=i.id,this.curItemIndex=this._getCurItemIndex(t);var n=this.originLists[this.curItemIndex+1];return n&&this._playInit(n.id),this}},pause:function(t){var i=this.playLists[t],s=i&&i.howl,n=0;return s&&(this.curItemId="",s.pause(),n=s.seek(),this.playLists[t].currentTime="object"!=typeof n?+n:0),this},stop:function(t){var i=this.playLists[t],s=i&&i.howl;return s&&(this.curItemId="",s.stop(),this.playLists[t].currentTime=0),this},seek:function(t,i){this._playInit(t).seek(+i)},destory:function(t,n){if("function"==typeof t&&(n=t,t=""),t){var i=this.playLists[t],s=i&&i.howl;return s&&(this.curItemId==t&&this.pause(t),s.unload(),this.playLists[t].howl=null,this.playLists[t].currentTime=0,n&&n(this.playLists[t])),this}this.curItemId&&this.pause(this.curItemId);var e=Object.keys(this.playLists),r=this;return e.forEach(function(t,i){var s=r.playLists[t];s&&s.howl&&(s.howl.unload(),r.playLists[t].howl=null,r.playLists[t].currentTime=0),n&&e.length-1===i&&n(r.playLists)}),this},playNext:function(){if(""!==this.curItemIndex){var t=this.originLists[++this.curItemIndex];t&&(this.playLists[t.id].currentTime=0,this.play(t.id))}},playPre:function(t){if(""!==this.curItemIndex){var i=this.originLists[--this.curItemIndex];if(i){var s=this.playLists[i.id],n=s&&s.howl;void 0!==t&&n&&n.seek(0),this.play(i.id)}}}},t});